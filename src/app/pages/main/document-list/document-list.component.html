<div class="document">
  <button
    (click)="showAddDocumentModal()"
    class="document__add"
    nz-button
    nzType="default"
  >
    Добавить
  </button>

  <nz-table
    #sortTable
    [nzBordered]="true"
    [nzData]="listOfData"
    [nzLoading]="isLoadingTable"
    class="document__table"
    nzShowSizeChanger
    nzTableLayout="fixed"
  >
    <thead>
    <tr>
      <th nzCustomFilter nzWidth="200px">
        ID документа
        <nz-filter-trigger
          [(nzVisible)]="searchDocumentByFieldVisible.documentId"
          [nzActive]="
              searchDocumentByField.controls['documentId'].value.length > 0
            "
          [nzDropdownMenu]="menu"
        >
          <span nz-icon nzType="search"></span>
        </nz-filter-trigger>
      </th>
      <th nzCustomFilter>
        Заголовок
        <nz-filter-trigger
          [(nzVisible)]="searchDocumentByFieldVisible.title"
          [nzActive]="
              searchDocumentByField.controls['title'].value.length > 0
            "
          [nzDropdownMenu]="menu"
        >
          <span nz-icon nzType="search"></span>
        </nz-filter-trigger>
      </th>
      <th nzCustomFilter>
        Документ
        <nz-filter-trigger
          [(nzVisible)]="searchDocumentByFieldVisible.documentName"
          [nzActive]="
              searchDocumentByField.controls['documentName'].value.length > 0
            "
          [nzDropdownMenu]="menu"
        >
          <span nz-icon nzType="search"></span>
        </nz-filter-trigger>
      </th>
      <th nzCustomFilter nzWidth="200px">
        Дата создания
        <nz-filter-trigger
          [(nzVisible)]="searchDocumentByFieldVisible.createdDate"
          [nzActive]="
              searchDocumentByField.controls['createdDate'].value.length > 0
            "
          [nzDropdownMenu]="menu"
        >
          <span nz-icon nzType="search"></span>
        </nz-filter-trigger>
      </th>
      <th nzWidth="250px"></th>
    </tr>
    </thead>
    <tbody class="document__table__tbody">
      @for (data of sortTable.data; track data) {
        <tr>
          <td>{{ data.id }}</td>
          <td>{{ data.title | textMask: 20 }}</td>
          <td>{{ data.document | textMask: 20 }}.pdf</td>
          <td>{{ data.createdDate | date: "dd.MM.YYYY" }}</td>
          <td class="document__table__tbody__td">
            <div class="document__table__tbody__td__action">
              <nz-tag
                style="cursor: pointer"
                [routerLink]="['/admin/documents', data.id]"
              >Смотреть
              </nz-tag
              >
              <nz-tag
                style="cursor: pointer"
                [nzColor]="'cyan'"
                (click)="downloadDocument()"
              >Скачать
              </nz-tag
              >
              <nz-tag
                style="cursor: pointer"
                [nzColor]="'volcano'"
                (click)="deleteDocument(data.id)"
              >Удалить
              </nz-tag
              >
            </div>
          </td>
        </tr>
      }
    </tbody>
  </nz-table>
</div>

<nz-dropdown-menu #menu="nzDropdownMenu">
  <div [formGroup]="searchDocumentByField" class="ant-table-filter-dropdown">
    <div class="search-box">
      @if (searchDocumentByFieldVisible.documentId) {
        <input
          formControlName="documentId"
          nz-input
          placeholder="Search documentId"
          type="text"
        />
        <button
          (click)="search()"
          class="search-button"
          nz-button
          nzSize="default"
          nzType="primary"
        >
          Search
        </button>
        <button (click)="reset()" nz-button nzSize="default">Reset</button>
      }
      @if (searchDocumentByFieldVisible.title) {
        <input
          formControlName="title"
          nz-input
          placeholder="Search title"
          type="text"
        />
        <button
          (click)="search()"
          class="search-button"
          nz-button
          nzSize="default"
          nzType="primary"
        >
          Search
        </button>
        <button (click)="reset()" nz-button nzSize="default">Reset</button>
      }
      @if (searchDocumentByFieldVisible.createdDate) {
        <!--        <nz-date-picker nzFormat="dd/MM/yyyy" formControlName="createdDate" nzSize="default"></nz-date-picker>-->
        <button
          (click)="search()"
          class="search-button"
          nz-button
          nzSize="default"
          nzType="primary"
        >
          Search
        </button>
        <button (click)="reset()" nz-button nzSize="default">Reset</button>
      }
      @if (searchDocumentByFieldVisible.documentName) {
        <input
          formControlName="documentName"
          nz-input
          placeholder="Search documentName"
          type="text"
        />
        <button
          (click)="search()"
          class="search-button"
          nz-button
          nzSize="default"
          nzType="primary"
        >
          Search
        </button>
        <button (click)="reset()" nz-button nzSize="default">Reset</button>
      }
    </div>
  </div>
</nz-dropdown-menu>

<nz-modal
  (nzOnCancel)="handleCancelDocumentModal()"
  (nzOnOk)="handleOkDocumentModal()"
  [(nzVisible)]="isVisibleAddDocumentModal"
  nzCentered
  nzTitle="Название документа"
>
  <ng-container *nzModalContent>
    <form [formGroup]="addDocumentForm">
      <nz-input-group [nzSuffix]="suffixTemplateInfo" nzAddOnAfter=".pdf">
        <input formControlName="title" nz-input type="text"/>
      </nz-input-group>

      <ng-template #suffixTemplateInfo>
        <span
          nz-icon
          nz-tooltip
          nzTooltipTitle="Название документа должно быть указано!"
          nzType="info-circle"
        ></span>
      </ng-template>
    </form>
  </ng-container>
</nz-modal>
